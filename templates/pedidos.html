<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Pedidos - Cambr√≠</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

  <style>
    /* === Estilos generales === */
    .table-container {
      max-height: 320px;
      overflow-y: scroll;
      overflow-x: auto;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      background-color: #fff;
      margin-top: 10px;
      scrollbar-width: thin;
      scrollbar-color: #ccc #f5f5f5;
    }

    /* Scrollbar personalizada para navegadores WebKit */
    .table-container::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    .table-container::-webkit-scrollbar-thumb {
      background-color: #c1c1c1;
      border-radius: 4px;
    }
    .table-container::-webkit-scrollbar-thumb:hover {
      background-color: #a8a8a8;
    }

    .table {
      width: 100%;
      border-collapse: collapse;
      min-width: 950px;
    }

    .table th, .table td {
      padding: 12px 15px;
      text-align: center;
      border-bottom: 1px solid #e0e0e0;
      vertical-align: middle;
    }

    .table th {
      background-color: #f5f7fa;
      font-weight: 600;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    /* === Select editable con colores === */
    select.estado-editable {
      border: none;
      padding: 6px 10px;
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
      text-align: center;
      color: #fff;
      transition: background-color 0.3s ease;
    }

    /* Colores seg√∫n estado */
    .estado-pendiente {
      background-color: #4da3ff; /* Azul */
    }

    .estado-aceptado {
      background-color: #48c78e; /* Verde */
    }

    .estado-en-proceso {
      background-color: #ffd166; /* Amarillo */
      color: #333;
    }

    select.estado-editable:focus {
      outline: none;
      filter: brightness(0.95);
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- ==== Sidebar ==== -->
    <aside class="sidebar">
      <div class="brand">
        <a href="{{ url_for('volver') }}" class="brand-link">Cambri</a>
      </div>
      <nav class="menu">
        <li><a href="{{ url_for('pedidos') }}" class="active"><i class="fas fa-box"></i> Pedidos</a></li>
        <a href="{{ url_for('produccion') }}"><i class="fas fa-industry"></i> Producci√≥n</a>
        <a href="{{ url_for('inventario') }}"><i class="fas fa-boxes"></i> Inventario</a>
        <a href="{{ url_for('reportes') }}"><i class="fas fa-chart-line"></i> Reportes</a>
      </nav>
      <div class="logout">Cerrar sesi√≥n</div>
    </aside>

    <!-- ==== Contenido principal ==== -->
    <main class="main">
      <header class="header">
        <h1>M√≥dulo de Pedidos</h1>
      </header>

      <section class="grid">

        <div class="card pedidos">
  <div class="card-title">Registrar Pedido</div>
  <form class="pedido-form" action="{{ url_for('crear_pedido') }}" method="POST">
    <label>Cliente:</label>
    <input type="text" name="cliente" placeholder="Nombre del cliente" required>

    <label>Estado:</label>
    <select name="estado">
      <option>Pendiente</option>
      <option>Aceptado</option>
      <option>En proceso</option>
    </select>

    <label>Contacto:</label>
    <input type="text" name="contacto" placeholder="Correo o tel√©fono" required>

    <label>Fecha de registro:</label>
    <input type="date" name="fecha" required>

    <label>Costo:</label>
    <input type="number" step="0.01" name="costo" placeholder="Valor del pedido" required>

    <label>Descripci√≥n:</label>
    <textarea name="descripcion" placeholder="Descripci√≥n del pedido" required></textarea>

    <button type="submit">Guardar Pedido</button>
  </form>
</div>

        <!-- ==== Registrar Pedido ==== -->
        <div class="card pedidos">
          <div class="card-title">Registrar Pedido</div>
          <form class="pedido-form">
            <label>Cliente:</label>
            <input type="text" placeholder="Nombre del cliente" required>

            <label>Estado:</label>
            <select>
              <option>Pendiente</option>
              <option>Aceptado</option>
              <option>En proceso</option>
            </select>

            <label>Contacto:</label>
            <input type="text" placeholder="Correo o tel√©fono de contacto" required>

            <label>Fecha de registro:</label>
            <input type="date" required>

            <label>Costo:</label>
            <input type="number" step="0.01" placeholder="Valor del pedido" required>

            <label>Descripci√≥n:</label>
            <textarea placeholder="Descripci√≥n del pedido" required></textarea>

            <button type="submit">Guardar Pedido</button>
          </form>
        </div>
<div class="card pedidos">
  <div class="card-title">Pedidos Registrados</div>
  <div class="table-container">
    <table class="table">
      <thead>
        <tr>
          <th>ID Pedido</th>
          <th>Cliente</th>
          <th>Estado</th>
          <th>Contacto</th>
          <th>Fecha de Registro</th>
          <th>Costo</th>
          <th>Descripci√≥n</th>
          <th>Eliminar</th>
        </tr>
      </thead>
      <tbody>
        {% for p in pedidos %}
        <tr data-id="{{ p.id }}">
          <td>{{ p.id }}</td>
          <td>{{ p.cliente }}</td>
          <td>
            <select class="estado-editable">
              <option {% if p.estado == 'Pendiente' %}selected{% endif %}>Pendiente</option>
              <option {% if p.estado == 'Aceptado' %}selected{% endif %}>Aceptado</option>
              <option {% if p.estado == 'En proceso' %}selected{% endif %}>En proceso</option>
            </select>
          </td>
          <td>{{ p.contacto }}</td>
          <td>{{ p.fecha }}</td>
          <td>${{ "%.0f"|format(p.costo) }}</td>
          <td>{{ p.descripcion }}</td>
          <td>
            <form action="{{ url_for('eliminar_pedido', id=p.id) }}" method="POST" style="display:inline;">
              <button type="submit" style="background:red;color:white;border:none;padding:5px 10px;border-radius:6px;">üóëÔ∏è</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

        <!-- ==== Pedidos Registrados ==== -->
        <div class="card pedidos">
          <div class="card-title">Pedidos Registrados</div>
          <div class="table-container">
            <table class="table">
              <thead>
                <tr>
                  <th>ID Pedido</th>
                  <th>Cliente</th>
                  <th>Estado</th>
                  <th>Contacto</th>
                  <th>Fecha de Registro</th>
                  <th>Costo</th>
                  <th>Descripci√≥n</th>
                </tr>
              </thead>
              <tbody>
                <!-- === Registros existentes + nuevos === -->
                <tr><td>1001</td><td>Maria Inc.</td><td><select class="estado-editable"><option selected>Pendiente</option><option>Aceptado</option><option>En proceso</option></select></td><td>maria@inc.com</td><td>2025-10-20</td><td>$250.000</td><td>Pedido de insumos textiles</td></tr>
                <tr><td>1002</td><td>Julia SA</td><td><select class="estado-editable"><option>Pendiente</option><option selected>Aceptado</option><option>En proceso</option></select></td><td>+57 310 456 7890</td><td>2025-10-21</td><td>$180.000</td><td>Uniformes corporativos</td></tr>
                <tr><td>1003</td><td>Pedro SP</td><td><select class="estado-editable"><option>Pendiente</option><option>Aceptado</option><option selected>En proceso</option></select></td><td>pedro.sp@gmail.com</td><td>2025-10-22</td><td>$320.000</td><td>Pedido de confecci√≥n personalizada</td></tr>
                <tr><td>1004</td><td>Luc√≠a Design</td><td><select class="estado-editable"><option selected>Pendiente</option><option>Aceptado</option><option>En proceso</option></select></td><td>lucia@design.co</td><td>2025-10-23</td><td>$290.000</td><td>Dise√±o de prototipos</td></tr>
                <tr><td>1005</td><td>TextilModa</td><td><select class="estado-editable"><option>Pendiente</option><option selected>Aceptado</option><option>En proceso</option></select></td><td>ventas@textilmoda.com</td><td>2025-10-23</td><td>$410.000</td><td>Uniformes empresariales</td></tr>
                <tr><td>1006</td><td>Creativa LTDA</td><td><select class="estado-editable"><option>Pendiente</option><option>Aceptado</option><option selected>En proceso</option></select></td><td>contacto@creativa.com</td><td>2025-10-24</td><td>$520.000</td><td>Camisetas serigrafiadas</td></tr>
                <tr><td>1007</td><td>Innovatex</td><td><select class="estado-editable"><option selected>Pendiente</option><option>Aceptado</option><option>En proceso</option></select></td><td>ventas@innovatex.com</td><td>2025-10-25</td><td>$610.000</td><td>Pedido de telas t√©cnicas</td></tr>
                <tr><td>1008</td><td>FabricaAndina</td><td><select class="estado-editable"><option>Pendiente</option><option selected>Aceptado</option><option>En proceso</option></select></td><td>info@fabricaandina.co</td><td>2025-10-25</td><td>$740.000</td><td>Textiles industriales</td></tr>
                <tr><td>1009</td><td>ModaExpress</td><td><select class="estado-editable"><option selected>Pendiente</option><option>Aceptado</option><option>En proceso</option></select></td><td>contacto@modaexpress.co</td><td>2025-10-26</td><td>$380.000</td><td>Prendas personalizadas</td></tr>
                <tr><td>1010</td><td>Estilo SA</td><td><select class="estado-editable"><option>Pendiente</option><option>Aceptado</option><option selected>En proceso</option></select></td><td>estilo@sa.com</td><td>2025-10-27</td><td>$450.000</td><td>Dise√±o de nuevos uniformes</td></tr>
                <tr><td>1011</td><td>CreacionesLuz</td><td><select class="estado-editable"><option selected>Pendiente</option><option>Aceptado</option><option>En proceso</option></select></td><td>creaciones@luz.co</td><td>2025-10-27</td><td>$560.000</td><td>Vestuario para eventos</td></tr>
                <tr><td>1012</td><td>AlphaDesign</td><td><select class="estado-editable"><option>Pendiente</option><option>Aceptado</option><option selected>En proceso</option></select></td><td>info@alphadesign.com</td><td>2025-10-28</td><td>$300.000</td><td>Dise√±os prototipo</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
function actualizarColor(select) {
  select.classList.remove('estado-pendiente', 'estado-aceptado', 'estado-en-proceso');
  const estado = select.value.toLowerCase().trim();
  if (estado === 'pendiente') select.classList.add('estado-pendiente');
  else if (estado === 'aceptado') select.classList.add('estado-aceptado');
  else if (estado === 'en proceso') select.classList.add('estado-en-proceso');
}

document.querySelectorAll('.estado-editable').forEach(select => {
  actualizarColor(select);
  select.addEventListener('change', function() {
    actualizarColor(this);
    const row = this.closest('tr');
    const id = row.getAttribute('data-id');
    const estado = this.value;

    fetch(`/pedidos/actualizar/${id}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ estado })
    })
    .then(r => r.json())
    .then(data => console.log(data.mensaje));
  });
});
</script>

  <script>
    // === Asigna color al select seg√∫n el estado ===
    function actualizarColor(select) {
      select.classList.remove('estado-pendiente', 'estado-aceptado', 'estado-en-proceso');
      const estado = select.value.toLowerCase().trim();
      if (estado === 'pendiente') select.classList.add('estado-pendiente');
      else if (estado === 'aceptado') select.classList.add('estado-aceptado');
      else if (estado === 'en proceso') select.classList.add('estado-en-proceso');
    }

    document.querySelectorAll('.estado-editable').forEach(select => {
      actualizarColor(select); // Color inicial
      select.addEventListener('change', function() {
        actualizarColor(this);
        const row = this.closest('tr');
        const estado = this.value;
        console.log(`Pedido actualizado: ${row.children[0].innerText} - Nuevo estado: ${estado}`);
      });
    });
  </script>
</body>
</html>
